#!/usr/bin/python
import os,sys,string,subprocess,commands
if len(sys.argv)>1:
	args=sys.argv[1:]
else:
	args=["",]
dn = os.path.dirname(os.path.realpath(__file__))
dn=dn[:dn.rfind(os.sep)]
os.putenv("SPECK",dn)
print "+++++++++++++++++++++++++++++++++++++++++"
print "SPECK says: 'dans le cochon tout est bon'" 
print "+++++++++++++++++++++++++++++++++++++++++"
print "This speck folder is : %s"%dn

print ">Setting TANGO environment variables"
os.system("%s/bin/tango_config"%(dn))

print ">Checking ipython version"
status, out = commands.getstatusoutput("ipython -Version")
#proc = subprocess.Popen(["ipython", "-Version"], stdout=subprocess.PIPE, stderr=subprocess.PIPE,shell=True)
#(out, err) = proc.communicate()
if not(status):
	Version=out
else:
	status, out = commands.getstatusoutput("ipython --version")
	if not(status):
		Version=out
	else:
		raise Exception("speck starter: unknown ipython version!")
print "Python version is %s"%Version
print ""
print ">Starting speck environment"
print ""
if float(Version)<0.11:
	#Compatibility with older versions (namely beamline old ipython)
	os.system("EDITOR=gedit VERSION=%s /usr/bin/ipython -i --pylab  --profile=speck_profile --autocall 2 --colors LightBG --gui=gtk --ipython-dir %s/profile"\
	%(Version,dn+os.sep+"speck_profile"+os.sep+"starter")\
	+string.join(args))
else:
	os.system("EDITOR=gedit VERSION=%s /usr/bin/ipython -i --pylab  --profile=speck_profile --autocall 2 --colors LightBG --gui=gtk --ipython-dir %s/profile"%(Version,dn)\
+string.join(args))

